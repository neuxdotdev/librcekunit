name: Rust CI

on:
    push:
        branches: ["main"]
    pull_request:
        branches: ["main"]

env:
    CARGO_TERM_COLOR: always
    RUST_LOG: trace

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Rust toolchain
              uses: actions-rs/toolchain@v1
              with:
                  toolchain: stable
                  override: true
            - name: Cache cargo registry
              uses: actions/cache@v4
              with:
                  path: |
                      ~/.cargo/registry
                      ~/.cargo/git
                  key: cargo-registry-${{ runner.os }}-${{ hashFiles('**/Cargo.lock') }}
                  restore-keys: cargo-registry-${{ runner.os }}-

            - name: Cache cargo build
              uses: actions/cache@v4
              with:
                  path: target
                  key: cargo-build-${{ runner.os }}-${{ hashFiles('**/Cargo.lock') }}
                  restore-keys: cargo-build-${{ runner.os }}-
            - name: Build project
              run: cargo build --verbose
            - name: Upload build artifacts
              uses: actions/upload-artifact@v3
              with:
                  name: rust-target
                  path: target/debug/
